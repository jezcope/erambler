box: jezcope/erambler-nikola:latest
build:
  steps:
    - script:
        name: update submodules
        code: |
          git submodule update --init --recursive
    - script:
        name: compile site
        code: |
          nikola build
deploy:
  steps:
    - script:
        name: deploy site to production
        code: |
          nikola deploy
  testing:
    - script:
        name: configure git
        code: |-
          git config --global user.email "j.cope@erambler.co.uk"
          git config --global user.name "Jez Cope"

          rm -rf .git
    - script:
        name: deploy to github pages
        code: |-
          cd .output

          git init
          git add .
          git commit -m "Deploy commit from $WERCKER_STARTED_BY"
          git push -f $GIT_REMOTE master:gh-pages
